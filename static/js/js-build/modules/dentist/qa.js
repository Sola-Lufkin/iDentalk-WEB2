define(["jquery","jquery-ui","ajaxform","validate","lightbox","tmpl","confirmbox"],function(){var e={_constructor:{url_sub:"/ajax/d/putqa/",url_del:"/ajax/d/deleteqa/",url_update:"/ajax/d/updateqa/",url_sort:"/ajax/d/moveqaplace/"},init:function(){$(".qa-item").hover(function(){$(".qa-toobar").hide(),$(this).find(".qa-toobar").show()},function(){$(".qa-toobar").hide()}),this.update(),this.del(),this.sort()},create:function(){$("#new_qa").identalk_lightbox({height:385,width:750,content:$(".qa-form-wrap").html(),afterLoad:function(){var t=$(".orange-wrap");t.find(".sub_qa").click(function(n){n.preventDefault(),t.find(".qa-form").valid()&&t.find(".qa-form").identalk_ajaxform({callback:function(t){$(".orange-close").click(),loadings.autohide(t.msg),$("#qa_list").children(".den-tip").hide().end().append($("#qa_tmpl").tmpl(t)),e.init()}})})}})},render:function(e){e.length===0?$("#qa_list .den-tip").show():$("#qa_list").empty().append($("#qa_tmpl").tmpl(e))},update:function(){$(".update-qa").unbind("click").on("click",function(){var t=$(this),n=t.parent().parent().siblings(".question"),r=t.parent().parent().siblings(".answer"),i={id:t.data("id")};$(this).identalk_lightbox({height:385,width:750,open:!0,content:$(".qa-form-wrap").html(),afterLoad:function(){var t=$(".orange-wrap");t.find('input[name="question"]').val(n.text()),t.find('textarea[name="answer"]').val(r.text()),t.find(".sub_qa").click(function(s){s.preventDefault(),t.find(".qa-form").identalk_ajaxform({url:e._constructor.url_update,addData:i,callback:function(e){$(".orange-close").click(),loadings.autohide(e.msg),n.text(e.question),r.text(e.answer)}})})}})})},sort:function(){$("#qa_list").sortable({axis:"y",cursor:"move",handle:".sort-qa",opacity:.7,update:function(t,n){var r=n.item,i=[];$("#qa_list li").each(function(){i.push($(this).data("id"))});var s={ids:i};$.ajax({url:e._constructor.url_sort,data:{ids:i.toString()},success:function(e){loadings.autohide(e.msg)}})}})},del:function(){$(".del-qa").unbind("click").bind("click",function(){var t=$(this).data("id"),n=$('.qa-item[data-id="'+t+'"]');$.ajax({url:e._constructor.url_del,data:{id:t},success:function(e){loadings.autohide(e.msg),n.slideUp()}})}).confirmbox()}};return e});