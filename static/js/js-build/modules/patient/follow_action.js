define(["jquery","lightbox","ajaxform"],function(){var e=function(e,t,n){if(t.indexOf("unconnect")!==-1){if(!confirm("Are your sure to unconnect this dentist ?"))return;$.ajax({url:t,success:function(r){e.attr("href",t.replace("unconnect","connect")).text("Connect"),e.prev().show(),n?refresh():loadings.autohide(r.msg)}})}else $.ajax({url:t,success:function(r){r.status&&(t.indexOf("follow")!==-1&&e.attr("href",t.replace("follow","unfollow")).text("Unfollow"),t.indexOf("unfollow")!==-1&&e.attr("href",t.replace("unfollow","follow")).text("Follow"),t.indexOf("cancelrequest")!==-1&&(e.attr("href",t.replace("cancelrequest","connect")).text("Connect"),e.prev().show())),n?refresh():loadings.autohide(r.msg)}})};return function(){var t=arguments[0]||!1;$(".follow-action").unbind("click").on("click",function(n){n.preventDefault();if($(".userinfo").length==0)window.location.href="/signup/p";else{var r=$(this),i=this.href;i.indexOf("connect")!==-1&&i.indexOf("unconnect")==-1?r.identalk_lightbox({height:195,width:372,open:!0,content:'<form class="form" action=""> 								<div class="control-group"> 								<div class="controls clearfix ml10"> 								<textarea class="span4" name="msg" row="10" placeholder="You can leave a message to the dentist"></textarea> 								</div> 								<div class="form-actions"><button type="button" class="sub-msg btn btn-success pull-right">OK</button></div> 								</div> 								</form>',afterLoad:function(){var e=$(".orange-content");e.find(".sub-msg").click(function(){e.find(".form").identalk_ajaxform({url:i,callback:function(e){e.status&&i.indexOf("connect")!==-1&&(r.attr("href",i.replace("connect","cancelrequest")).text("Cancel connect"),r.prev().hide()),$(".orange-close").click(),t?refresh():loadings.autohide(e.msg)}})})}}):e(r,i,t)}})}});