define(["jquery","valuecheck","btnmask"],function(){var e={_constructor:{url_get_post:"/ajax/p/stream/getpost/",url_get_comment:"/ajax/p/stream/getcomment/",url_comment:"/ajax/stream/comment/"},init:function(){this.get(),this.comment.init()},get:function(){var t=e._constructor;$.ajax({url:t.url_get_post,success:function(t){e.render(t)}})},render:function(t){t[0].id?($("#msg_flow").empty().hide().append($("#stream_tmpl").tmpl(t)).fadeIn(500),this.more(),this.zoom_pic(),e.comment.init()):($("#msg_flow").remove(),$(".timeline-footer").remove(),$("#timeline").append('<h3 class="text-center"><a href="/geoloc-search/myloc/">Search</a> for a Dentist</h3>'))},more:function(){var t=e._constructor,n=1;if($(".stream").length>=10){var r=$('<div class="stream get-more-post"><div class="stream-content"><dl class="stream-avatar more-post"><i class="icon-refresh"></i></dl></div></div>');$(".stream:last-child").after(r),$(".more-post").click(function(){n+=1,$.ajax({url:t.url_get_post,data:{page:n},success:function(t){t[0].is_end?$(".more-post").unbind("click").addClass("disabled"):($(".stream").not(".get-more-post").last().after($("#stream_tmpl").tmpl(t)).nextAll().hide().fadeIn(500),e.zoom_pic(),e.comment.init())}})})}},zoom_pic:function(){$(".upload-img").unbind("click").click(function(e){e.preventDefault();var t=$(this);t.hasClass("preview-pic")?t.removeClass("preview-pic").children().attr("src",t.attr("href")):t.addClass("preview-pic").children().attr("src",t.data("big-pic"))})},comment:{init:function(){this.get(),this.sub()},get:function(){var t=e._constructor;$(".comment").unbind("click").click(function(){var e=$("#comments_"+this.rel),n=$(this).attr("rel");e.hasClass("hide")?(e.removeClass("hide"),$.ajax({url:t.url_get_comment,data:{post_id:n},success:function(e){$("#comments-tree_"+n).hide().append($("#comment_tmpl").tmpl(e)).fadeIn(500)}})):(e.addClass("hide"),$("#comments-tree_"+n).empty())})},sub:function(){var t=e._constructor;$(".sub-comment").unbind("click").click(function(){var e=$(this),n=e.attr("rel"),r=e.prev().val();if(!e.prev().identalk_valuecheck())return;e.identalk_btnMask("open"),$.ajax({url:t.url_comment,data:{pid:n,comment:r},success:function(t){t.status&&($("#comments-tree_"+n).append($("#comment_tmpl").tmpl(t)),$("textarea[name=comment-content]").val("").text(""),$(".comment[rel="+n+"] .comment-count").text(t.comment_count),e.identalk_btnMask("close"))}})})}}};return e});