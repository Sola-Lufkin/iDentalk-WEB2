define(["jquery","jcrop","lightbox","fileupload","ajaxform"],function(e){var t={popup_avatar:function(){var n={};return n.init=function(){e(".avatar-wrapper").hover(function(){e(this).children(".img-tip").removeClass("hide")},function(){e(this).children(".img-tip").addClass("hide")}),this.open_panel()},n.open_panel=function(){e(".avatar").identalk_lightbox({width:600,autoheight:!0,content:e("#upload_avatar_wrapper .well").clone().html(),afterLoad:function(){e(".orange-wrap .ferret").attr("src",e(".avatar").attr("src")),t.popup_avatar().edit()}})},n.edit=function(){var t=e(".orange-wrap");t.find(".choose_avatar").identalk_fileupload({form_target:"avatar_upload_iframe",form_action:"/ajax/saveimg/",file_name:"imagephoto",afterLoad:function(n){try{jcrop_api.destroy()}catch(r){}if(n.indexOf("msg")!==-1){loadings.autohide(n.split(",")[1]);return}var n=n.split(",");t.find(".ferret").attr("src",n[0]).css({width:n[1],height:n[2]}),t.find(".ferret").Jcrop({setSelect:[50,10,200,200],aspectRatio:1,onSelect:function(e){t.find('input[name="x1"]').val(e.x),t.find('input[name="y1"]').val(e.y),t.find('input[name="x2"]').val(e.x2),t.find('input[name="y2"]').val(e.y2)}},function(){jcrop_api=this}),t.find(".upload_avatar").show().unbind("click").click(function(t){t.preventDefault();var n=e(this);if(n.hasClass("disabled"))return;n.addClass("disabled"),loadings.show(),e(".orange-wrap").find(".resize_form").identalk_ajaxform({url:"/ajax/cutimg/",callback:function(e){loadings.show(e.msg),refresh()},onerror:function(e){n.removeClass("disabled")}}),n.hide()})}})},n},step_avatar:function(){var e={};return e}};return t});