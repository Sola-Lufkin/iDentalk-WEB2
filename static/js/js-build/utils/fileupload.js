define(["jquery"],function(e){e.fn.identalk_fileupload=function(t){function u(){o.load(function(){r.afterLoad=t.afterLoad||undefined,o.unbind("load").bind("load",function(){loadings.hide();var t=e(this).contents().get(0),n=e(t).find("body").html();r.afterLoad!==undefined&&r.afterLoad(n)})})}var n={ie:e.browser.msie,safari:e.browser.safari,file_count:1,form_target:"/",form_action:"/",file_name:"file"},r=e.extend({},n,t),i=e('<input type="file">'),s=e('<form class="fake_upload" method="POST"></form>'),o=e('<iframe src="javascript:false;" name="'+r.form_target+'"></iframe>');return this.each(function(){var t=e(this);t.find(".fake_upload").length>0&&t.find(".fake_upload").remove(),o.addClass("hide"),i.prop("name",r.file_name),u(),s.unbind("change").bind("change",function(){s.submit(),loadings.show()}),i.css({opacity:0,filter:"alpha(opacity=0)",position:"absolute",height:t.outerHeight()*3||60,right:0,top:0,cursor:"pointer","font-size":"118px"}),s.css({opacity:0,filter:"alpha(opacity=0)",position:"relative",width:t.outerWidth()||200,top:-10,right:-100}).prop("target",r.form_target).prop("action",r.form_action).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data").append(i).append(o),t.css({overflow:"hidden"}).prepend(s)}),this}});